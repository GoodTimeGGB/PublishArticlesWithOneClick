/**
 * highlight.js - 简化版本
 * 仅包含核心高亮功能
 */

(function(global) {
  'use strict';

  var hljs = {
    highlight: function(code, options) {
      if (!options || !options.language) {
        return { value: escapeHtml(code) };
      }
      
      var lang = options.language.toLowerCase();
      var result = highlightLanguage(code, lang);
      return { value: result };
    },
    
    getLanguage: function(name) {
      return languages[name.toLowerCase()];
    },
    
    registerLanguage: function(name, language) {
      languages[name.toLowerCase()] = language;
    }
  };

  function escapeHtml(text) {
    return text
      .replace(/&/g, '&amp;')
      .replace(/</g, '&lt;')
      .replace(/>/g, '&gt;')
      .replace(/"/g, '&quot;')
      .replace(/'/g, '&#39;');
  }

  function highlightLanguage(code, lang) {
    var language = languages[lang];
    if (!language) {
      return escapeHtml(code);
    }

    var result = code;
    
    if (language.keywords) {
      result = highlightKeywords(result, language.keywords);
    }
    
    if (language.contains) {
      result = highlightContains(result, language.contains);
    }
    
    return result;
  }

  function highlightKeywords(code, keywords) {
    var sortedKeywords = Object.keys(keywords).sort(function(a, b) {
      return b.length - a.length;
    });
    
    sortedKeywords.forEach(function(keyword) {
      var type = keywords[keyword];
      var className = 'hljs-' + type;
      var regex = new RegExp('\\b(' + escapeRegex(keyword) + ')\\b', 'g');
      code = code.replace(regex, '<span class="' + className + '">$1</span>');
    });
    
    return code;
  }

  function highlightContains(code, contains) {
    contains.forEach(function(item) {
      if (item.className && item.begin) {
        var begin = typeof item.begin === 'string' ? item.begin : item.begin.source;
        var end = item.end ? (typeof item.end === 'string' ? item.end : item.end.source) : '';
        
        try {
          var regex = end 
            ? new RegExp('(' + begin + ')([\\s\\S]*?)(' + end + ')', 'g')
            : new RegExp('(' + begin + ')([\\s\\S]*?)(\n|$)', 'g');
          
          code = code.replace(regex, function(match, b, content, e) {
            return '<span class="hljs-' + item.className + '">' + escapeHtml(b) + escapeHtml(content) + (e ? escapeHtml(e) : '') + '</span>';
          });
        } catch (e) {}
      }
    });
    
    return code;
  }

  function escapeRegex(string) {
    return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
  }

  var languages = {
    javascript: {
      keywords: {
        'const': 'keyword',
        'let': 'keyword',
        'var': 'keyword',
        'function': 'keyword',
        'return': 'keyword',
        'if': 'keyword',
        'else': 'keyword',
        'for': 'keyword',
        'while': 'keyword',
        'do': 'keyword',
        'switch': 'keyword',
        'case': 'keyword',
        'break': 'keyword',
        'continue': 'keyword',
        'class': 'keyword',
        'extends': 'keyword',
        'new': 'keyword',
        'this': 'keyword',
        'super': 'keyword',
        'import': 'keyword',
        'export': 'keyword',
        'default': 'keyword',
        'from': 'keyword',
        'async': 'keyword',
        'await': 'keyword',
        'try': 'keyword',
        'catch': 'keyword',
        'finally': 'keyword',
        'throw': 'keyword',
        'typeof': 'keyword',
        'instanceof': 'keyword',
        'true': 'literal',
        'false': 'literal',
        'null': 'literal',
        'undefined': 'literal',
        'console': 'built_in',
        'window': 'built_in',
        'document': 'built_in',
        'Array': 'built_in',
        'Object': 'built_in',
        'String': 'built_in',
        'Number': 'built_in',
        'Boolean': 'built_in',
        'Date': 'built_in',
        'Math': 'built_in',
        'JSON': 'built_in',
        'Promise': 'built_in',
        'Map': 'built_in',
        'Set': 'built_in'
      },
      contains: [
        { className: 'string', begin: '"', end: '"' },
        { className: 'string', begin: "'", end: "'" },
        { className: 'string', begin: '`', end: '`' },
        { className: 'comment', begin: '//', end: '\n' },
        { className: 'comment', begin: '/\\*', end: '\\*/' },
        { className: 'number', begin: '\\b\\d+(\\.\\d+)?', end: '' }
      ]
    },
    
    python: {
      keywords: {
        'def': 'keyword',
        'class': 'keyword',
        'if': 'keyword',
        'elif': 'keyword',
        'else': 'keyword',
        'for': 'keyword',
        'while': 'keyword',
        'return': 'keyword',
        'import': 'keyword',
        'from': 'keyword',
        'as': 'keyword',
        'try': 'keyword',
        'except': 'keyword',
        'finally': 'keyword',
        'raise': 'keyword',
        'with': 'keyword',
        'lambda': 'keyword',
        'yield': 'keyword',
        'global': 'keyword',
        'nonlocal': 'keyword',
        'pass': 'keyword',
        'break': 'keyword',
        'continue': 'keyword',
        'True': 'literal',
        'False': 'literal',
        'None': 'literal',
        'and': 'keyword',
        'or': 'keyword',
        'not': 'keyword',
        'in': 'keyword',
        'is': 'keyword',
        'print': 'built_in',
        'len': 'built_in',
        'range': 'built_in',
        'str': 'built_in',
        'int': 'built_in',
        'float': 'built_in',
        'list': 'built_in',
        'dict': 'built_in',
        'set': 'built_in',
        'tuple': 'built_in'
      },
      contains: [
        { className: 'string', begin: '"', end: '"' },
        { className: 'string', begin: "'", end: "'" },
        { className: 'string', begin: '"""', end: '"""' },
        { className: 'comment', begin: '#', end: '\n' },
        { className: 'number', begin: '\\b\\d+(\\.\\d+)?', end: '' }
      ]
    },
    
    java: {
      keywords: {
        'public': 'keyword',
        'private': 'keyword',
        'protected': 'keyword',
        'class': 'keyword',
        'interface': 'keyword',
        'extends': 'keyword',
        'implements': 'keyword',
        'static': 'keyword',
        'final': 'keyword',
        'void': 'keyword',
        'return': 'keyword',
        'if': 'keyword',
        'else': 'keyword',
        'for': 'keyword',
        'while': 'keyword',
        'do': 'keyword',
        'switch': 'keyword',
        'case': 'keyword',
        'break': 'keyword',
        'continue': 'keyword',
        'new': 'keyword',
        'this': 'keyword',
        'super': 'keyword',
        'try': 'keyword',
        'catch': 'keyword',
        'finally': 'keyword',
        'throw': 'keyword',
        'throws': 'keyword',
        'import': 'keyword',
        'package': 'keyword',
        'true': 'literal',
        'false': 'literal',
        'null': 'literal',
        'String': 'built_in',
        'Integer': 'built_in',
        'Boolean': 'built_in',
        'System': 'built_in',
        'Object': 'built_in'
      },
      contains: [
        { className: 'string', begin: '"', end: '"' },
        { className: 'comment', begin: '//', end: '\n' },
        { className: 'comment', begin: '/\\*', end: '\\*/' },
        { className: 'number', begin: '\\b\\d+(\\.\\d+)?[fFdDlL]?', end: '' }
      ]
    },
    
    css: {
      keywords: {
        'important': 'keyword'
      },
      contains: [
        { className: 'selector', begin: '[.#]?[a-zA-Z][a-zA-Z0-9_-]*', end: '' },
        { className: 'property', begin: '[a-z-]+\\s*:', end: '' },
        { className: 'string', begin: '"', end: '"' },
        { className: 'string', begin: "'", end: "'" },
        { className: 'number', begin: '\\b\\d+(\\.\\d+)?(px|em|rem|%|vh|vw)?', end: '' },
        { className: 'color', begin: '#[0-9a-fA-F]{3,6}', end: '' },
        { className: 'comment', begin: '/\\*', end: '\\*/' }
      ]
    },
    
    html: {
      contains: [
        { className: 'tag', begin: '</?[a-zA-Z][a-zA-Z0-9]*', end: '/?>' },
        { className: 'attr', begin: '[a-zA-Z-]+\\s*=', end: '' },
        { className: 'string', begin: '"', end: '"' },
        { className: 'string', begin: "'", end: "'" },
        { className: 'comment', begin: '<!--', end: '-->' }
      ]
    },
    
    sql: {
      keywords: {
        'SELECT': 'keyword',
        'FROM': 'keyword',
        'WHERE': 'keyword',
        'INSERT': 'keyword',
        'UPDATE': 'keyword',
        'DELETE': 'keyword',
        'CREATE': 'keyword',
        'DROP': 'keyword',
        'ALTER': 'keyword',
        'TABLE': 'keyword',
        'INDEX': 'keyword',
        'VIEW': 'keyword',
        'JOIN': 'keyword',
        'LEFT': 'keyword',
        'RIGHT': 'keyword',
        'INNER': 'keyword',
        'OUTER': 'keyword',
        'ON': 'keyword',
        'AND': 'keyword',
        'OR': 'keyword',
        'NOT': 'keyword',
        'NULL': 'keyword',
        'AS': 'keyword',
        'ORDER': 'keyword',
        'BY': 'keyword',
        'GROUP': 'keyword',
        'HAVING': 'keyword',
        'LIMIT': 'keyword',
        'OFFSET': 'keyword',
        'UNION': 'keyword',
        'DISTINCT': 'keyword',
        'COUNT': 'built_in',
        'SUM': 'built_in',
        'AVG': 'built_in',
        'MAX': 'built_in',
        'MIN': 'built_in'
      },
      contains: [
        { className: 'string', begin: "'", end: "'" },
        { className: 'number', begin: '\\b\\d+(\\.\\d+)?', end: '' },
        { className: 'comment', begin: '--', end: '\n' }
      ]
    },
    
    bash: {
      keywords: {
        'if': 'keyword',
        'then': 'keyword',
        'else': 'keyword',
        'elif': 'keyword',
        'fi': 'keyword',
        'for': 'keyword',
        'while': 'keyword',
        'do': 'keyword',
        'done': 'keyword',
        'case': 'keyword',
        'esac': 'keyword',
        'function': 'keyword',
        'return': 'keyword',
        'exit': 'keyword',
        'echo': 'built_in',
        'cd': 'built_in',
        'ls': 'built_in',
        'cat': 'built_in',
        'grep': 'built_in',
        'sed': 'built_in',
        'awk': 'built_in',
        'find': 'built_in',
        'mkdir': 'built_in',
        'rm': 'built_in',
        'cp': 'built_in',
        'mv': 'built_in'
      },
      contains: [
        { className: 'string', begin: '"', end: '"' },
        { className: 'string', begin: "'", end: "'" },
        { className: 'comment', begin: '#', end: '\n' },
        { className: 'variable', begin: '\\$[a-zA-Z_][a-zA-Z0-9_]*', end: '' }
      ]
    },
    
    json: {
      contains: [
        { className: 'attr', begin: '"[^"]*"\\s*:', end: '' },
        { className: 'string', begin: '"', end: '"' },
        { className: 'number', begin: '\\b\\d+(\\.\\d+)?', end: '' },
        { className: 'literal', begin: '\\b(true|false|null)\\b', end: '' }
      ]
    },
    
    typescript: {
      keywords: {
        'const': 'keyword',
        'let': 'keyword',
        'var': 'keyword',
        'function': 'keyword',
        'return': 'keyword',
        'if': 'keyword',
        'else': 'keyword',
        'for': 'keyword',
        'while': 'keyword',
        'class': 'keyword',
        'interface': 'keyword',
        'type': 'keyword',
        'enum': 'keyword',
        'extends': 'keyword',
        'implements': 'keyword',
        'new': 'keyword',
        'this': 'keyword',
        'super': 'keyword',
        'import': 'keyword',
        'export': 'keyword',
        'default': 'keyword',
        'from': 'keyword',
        'async': 'keyword',
        'await': 'keyword',
        'try': 'keyword',
        'catch': 'keyword',
        'finally': 'keyword',
        'throw': 'keyword',
        'typeof': 'keyword',
        'instanceof': 'keyword',
        'public': 'keyword',
        'private': 'keyword',
        'protected': 'keyword',
        'readonly': 'keyword',
        'static': 'keyword',
        'abstract': 'keyword',
        'as': 'keyword',
        'is': 'keyword',
        'keyof': 'keyword',
        'infer': 'keyword',
        'never': 'keyword',
        'unknown': 'keyword',
        'any': 'keyword',
        'void': 'keyword',
        'null': 'literal',
        'undefined': 'literal',
        'true': 'literal',
        'false': 'literal',
        'string': 'built_in',
        'number': 'built_in',
        'boolean': 'built_in',
        'object': 'built_in',
        'Array': 'built_in',
        'Promise': 'built_in',
        'Map': 'built_in',
        'Set': 'built_in'
      },
      contains: [
        { className: 'string', begin: '"', end: '"' },
        { className: 'string', begin: "'", end: "'" },
        { className: 'string', begin: '`', end: '`' },
        { className: 'comment', begin: '//', end: '\n' },
        { className: 'comment', begin: '/\\*', end: '\\*/' },
        { className: 'number', begin: '\\b\\d+(\\.\\d+)?', end: '' }
      ]
    },
    
    go: {
      keywords: {
        'package': 'keyword',
        'import': 'keyword',
        'func': 'keyword',
        'return': 'keyword',
        'var': 'keyword',
        'const': 'keyword',
        'type': 'keyword',
        'struct': 'keyword',
        'interface': 'keyword',
        'map': 'keyword',
        'chan': 'keyword',
        'if': 'keyword',
        'else': 'keyword',
        'for': 'keyword',
        'range': 'keyword',
        'switch': 'keyword',
        'case': 'keyword',
        'default': 'keyword',
        'break': 'keyword',
        'continue': 'keyword',
        'goto': 'keyword',
        'fallthrough': 'keyword',
        'defer': 'keyword',
        'go': 'keyword',
        'select': 'keyword',
        'true': 'literal',
        'false': 'literal',
        'nil': 'literal',
        'iota': 'literal',
        'make': 'built_in',
        'new': 'built_in',
        'len': 'built_in',
        'cap': 'built_in',
        'append': 'built_in',
        'copy': 'built_in',
        'delete': 'built_in',
        'close': 'built_in',
        'panic': 'built_in',
        'recover': 'built_in',
        'print': 'built_in',
        'println': 'built_in'
      },
      contains: [
        { className: 'string', begin: '"', end: '"' },
        { className: 'string', begin: "'", end: "'" },
        { className: 'string', begin: '`', end: '`' },
        { className: 'comment', begin: '//', end: '\n' },
        { className: 'comment', begin: '/\\*', end: '\\*/' },
        { className: 'number', begin: '\\b\\d+(\\.\\d+)?', end: '' }
      ]
    },
    
    rust: {
      keywords: {
        'fn': 'keyword',
        'let': 'keyword',
        'mut': 'keyword',
        'const': 'keyword',
        'static': 'keyword',
        'pub': 'keyword',
        'mod': 'keyword',
        'use': 'keyword',
        'crate': 'keyword',
        'self': 'keyword',
        'super': 'keyword',
        'struct': 'keyword',
        'enum': 'keyword',
        'impl': 'keyword',
        'trait': 'keyword',
        'type': 'keyword',
        'where': 'keyword',
        'if': 'keyword',
        'else': 'keyword',
        'match': 'keyword',
        'for': 'keyword',
        'while': 'keyword',
        'loop': 'keyword',
        'break': 'keyword',
        'continue': 'keyword',
        'return': 'keyword',
        'true': 'literal',
        'false': 'literal',
        'Some': 'built_in',
        'None': 'built_in',
        'Ok': 'built_in',
        'Err': 'built_in',
        'Option': 'built_in',
        'Result': 'built_in',
        'Vec': 'built_in',
        'String': 'built_in',
        'Box': 'built_in'
      },
      contains: [
        { className: 'string', begin: '"', end: '"' },
        { className: 'comment', begin: '//', end: '\n' },
        { className: 'comment', begin: '/\\*', end: '\\*/' },
        { className: 'number', begin: '\\b\\d+(\\.\\d+)?', end: '' }
      ]
    }
  };

  languages.js = languages.javascript;
  languages.ts = languages.typescript;
  languages.py = languages.python;
  languages.rb = languages.ruby;
  languages.sh = languages.bash;
  languages.shell = languages.bash;

  if (typeof module !== 'undefined' && typeof exports === 'object') {
    module.exports = hljs;
  } else if (typeof define === 'function' && define.amd) {
    define(function() { return hljs; });
  } else {
    global.hljs = hljs;
  }

})(this);
